WASHINGTON (AP) - The Senate passed a $1.4 trillion government spending package Thursday in a last bipartisan burst of legislating before bolting for the holidays from a Capitol riven by impeachment.

Lawmakers cleared the two-bill package in a set of votes, sending it to President Donald Trump in time to forestall a possible government shutdown this weekend. The White House said Trump would sign it before Friday's midnight deadline.

The first measure, covering domestic programs, passed by a 71-23 vote. A Pentagon and homeland security measure passed hours later in an 81-11 vote that was the last Senate tally for the year.

The legislation delivers Trump a victory on his U.S.-Mexico border fence and gives Democrats long-sought domestic spending increases and a repeal of Obama-era taxes on high-cost health insurance plans. It blends spending increases for both sides - reelection fodder for lawmakers - with tax and benefit add-ons that will mean a roughly $400 billion boost to the deficit over 10 years.

The split-their-differences legislation was carrying a large number of unrelated provisions into law, drawing protests from fiscal conservatives. It would put in place an earlier spending deal that reversed unpopular and unworkable automatic spending cuts to defense and domestic programs - at a $1.6 trillion or so cost over the coming decade.

"These spending bills are a fiscal dumpster fire," said Sen. Mike Lee, R-Utah. "This is embarrassing."

Sen. Rob Portman, R-Ohio, left, talks with Senate Majority Leader Mitch McConnell of Ky., Thursday, Dec. 19, 2019, on Capitol Hill in Washington. (AP Photo/Patrick Semansky)

Key provisions include an expensive repeal of Obama-era taxes on high-cost health plans, help for retired coal miner, and an increase from 18 to 21 in the nationwide legal age to buy tobacco products. The tobacco measure was pushed by Senate Majority Leader Mitch McConnell, R-Ky.

The almost 2,400-page package reflects the reality of divided government and the enduring strength of the Capitol's appropriations process, which allows lawmakers to go to bat for their states and congressional districts.

McConnell emerged as a victor, winning the politically popular $6 billion pension rescue for about 100,000 retired coal miners, along with more parochial items such as help for his state's legal hemp industry and $410 million to build a new veterans hospital in Louisville.

GOP Sen. Richard Shelby of Alabama, the Senate Appropriations Committee chairman, secured many items for his state, includinga $378 million harbor dredging program. It's expected to deliver the lions share to a Shelby-backed initiative to deepen Mobile Harbor to accommodate larger cargo ships.

House Speaker Nancy Pelosi, D-Calif., was also a driving force, winning permanent repeal of a tax on high-cost "Cadillac" health insurance benefits that is unpopular with Democratic labor allies.

After months of negotiation, leading lawmakers cut a deal on Monday that gives Trump a steady stream of money for the border wall.

"I would have preferred no funding for the wall," said Vermont Sen. Patrick Leahy, the top Democrat on the Senate Appropriations Committee. "But the Republicans were clear. ... They stood with the president on the wall, as they seem to do time after time."

The bill also offered business-friendly provisions on export financing, flood insurance and immigrant workers. A tax on medical devices and health insurance plans would be repealed permanently.

The core of the spending bill is formed by the 12 annual agency appropriations bills passed by Congress each year. It fills in the details of a bipartisan framework from July that delivered about $100 billion in agency spending increases over the coming two years instead of automatic spending cuts.

The bill exceeds Trump's budget requests in virtually every domestic category, except for Trump's request for $8 billion-plus for the U.S.-Mexico wall. It was cut back to $1.4 billion, equal to last year's appropriation. The measure preserves Trump's ability to use his budget powers to tap other accounts for several times that amount. That's a blow for liberal opponents of the wall but an acceptable trade-off for Democrats who wanted to gain $27 billion in increases for domestic programs.

But the Democratic concession angered some Hispanic lawmakers. They lashed out at the head of the House Appropriations Committee, Rep. Nita Lowey, D-N.Y., rather than Pelosi.

"I told (Lowey) we don´t appreciate that we´re going to get thrown under the bus so she can pass this omnibus and she did exactly that," said Rep. Ruben Gallego, D-Ariz.

The trade-off for the wall money was Trump's signature on the broader package, which increases spending across the almost one-third of the budget that's passed by Congress each year. Popular bipartisan programs such as health research, veterans medical care, NASA, sewer and water projects, and law enforcement grants to states and local governments would get increases. The $738 billion Pentagon budget is a record, with increases for procurement of expensive weapons systems like the F-35 fighter.

The increase in the tobacco purchasing age to 21 also applies to e-cigarettes and vaping devices. Aides familiar with the talks said Pelosi agreed to the tobacco legislation as she also won help for unionized carpenters with lower drug costs under their health plans.

Anti-smoking activists were irate at the tobacco provision, saying it doesn't go far enough because it failed to ban flavored vaping products popular with teenagers. It also threatens to kill momentum for more stringent anti-vaping legislation backed by House Energy and Commerce Chairman Frank Pallone, D-N.J., who was one of only seven Democrats to oppose the domestic spending half of the two-bill package.

Approached in the Capitol on Thursday, a deflated-sounding Pallone declined to comment on his opposition to the bill.

For the first time in two decades, the bill would provide money for federal research on gun safety. That's a major legislative victory for Democrats, gun control supporters and researchers who have pushed to study gun violence in the same way scientists look at opioid overdoses and other public health crises. A law adopted in the 1990s has effectively blocked such research and prohibits federal agencies from engaging in advocacy on gun-related issues.

The bill provides $25 million for gun violence research, divided evenly between the National Institutes of Health and the Centers for Disease Control and Prevention.

Business groups praised a seven-year extension of the charter of the Export-Import Bank, which helps finance transactions benefiting U.S. exporters, as well as a renewal of the government's terrorism risk insurance program. The financially troubled government flood insurance program would be extended through September, as would several visa programs for both skilled and seasonal workers.

Most provisions enjoyed bipartisan support, including increases for medical research, combating the opioid epidemic, Head Start and child care grants to states.

Democrats also secured $425 million for states to upgrade their election systems, and they boosted the U.S. Census budget $1.4 billion above Trump's request. They won smaller increases for the Environmental Protection Agency, renewable energy programs and affordable housing.